{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/codes/Basics/errors.js","webpack:///./src/codes/Basics/index.js","webpack:///./src/codes/Basics/success.js","webpack:///./src/codes/Users/errors.js","webpack:///./src/codes/Users/index.js","webpack:///./src/codes/Users/success.js","webpack:///./src/codes/index.js","webpack:///./src/constantes.js","webpack:///./src/database/schemas/index.js","webpack:///./src/helpers/GPIO.js","webpack:///./src/index.js","webpack:///./src/initialize/EnvVar.js","webpack:///./src/initialize/NODE_ENV/database.js","webpack:///./src/initialize/NODE_ENV/index.js","webpack:///./src/initialize/NODE_ENV/server.js","webpack:///./src/initialize/express.js","webpack:///./src/initialize/index.js","webpack:///./src/initialize/mongo.js","webpack:///./src/routes/gate/gate.js","webpack:///./src/routes/gate/index.js","webpack:///./src/routes/gate/middlewares/index.js","webpack:///./src/routes/gate/middlewares/toogle.js","webpack:///./src/routes/index.js","webpack:///./src/routes/users/admin/authentification.js","webpack:///./src/routes/users/admin/getUsers.js","webpack:///./src/routes/users/admin/index.js","webpack:///./src/routes/users/admin/newToken.js","webpack:///./src/routes/users/helpers/checkIfDataExists.js","webpack:///./src/routes/users/helpers/index.js","webpack:///./src/routes/users/index.js","webpack:///./src/routes/users/middlewares/deleteUser.js","webpack:///./src/routes/users/middlewares/index.js","webpack:///./src/routes/users/middlewares/modifyUser.js","webpack:///./src/routes/users/middlewares/newUser.js","webpack:///./src/routes/users/users.js","webpack:///external \"body-parser\"","webpack:///external \"crypto\"","webpack:///external \"express\"","webpack:///external \"gpio\"","webpack:///external \"mongoose\"","webpack:///external \"my-own-logger\""],"names":["internalError","code","description","ok","emailExists","usernameExists","tokenExists","unknownTypeToCheck","wrongToken","tokenDoesNotExists","tokenIsNotSpecified","usernameIsNotSpecified","emailIsNotSpecified","nameIsNotSpecified","lastnameIsNotSpecified","passwordIsNotSpecified","userCreated","tokenAdded","DB_HOSTNAME_DEV","DB_PORT_DEV","DB_NAME_DEV","DB_HOSTNAME_PROD","DB_PORT_PROD","DB_NAME_PROD","SERVER_PORT_DEV","SERVER_PORT_PROD","DEFAULT_TOKEN","Schema","mongoose","initializeSchema","usersSchema","lastname","String","name","username","type","unique","email","password","token","Types","ObjectId","ref","versionKey","collection","tokenSchema","isAdmin","Boolean","isAllowed","User","model","Token","RELAIS","gpio","export","direction","DIRECTION","OUT","interval","ready","turnOn","then","setTimeout","turnOff","reset","set","init","setEnvVar","ne","cte","defineDB","NODE_ENV","process","env","DB_HOSTNAME","DB_PORT","DB_NAME","log","status","mode","value","definePort","SERVER_PORT","startServ","app","express","use","bodyParser","json","urlencoded","extended","rt","er","err","listen","startDB","url","options","promiseLibrary","Promise","useNewUrlParser","useFindAndModify","useCreateIndex","connectTimeoutMS","_mongooseConnectLogResult","error","connection","on","connect","GateRoute","Router","initializeRoute","put","mdl","toggle","UsersRoute","users","gate","initializeRoutes","callback","errors","authentificate","req","res","next","headers","undefined","userCode","send","query","find","data","iEr","basicsCode","length","filter","iWer","iTer","getUsers","usernames","body","FullUser","names","RegExp","forEach","slice","populate","exec","erC","results","map","user","erB","isTokenOk","checkIfDataExists","addToken","newToken","save","account","iErr","uSuc","suc","result","deleteUser","modifyUser","isMailOk","isUsernameOk","register","crypto","randomBytes","toString","i","safePwd","createHash","update","digest","post","delete","admin","get"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export const internalError = {\r\n  code: 'e500',\r\n  description: 'internal error occured'\r\n}\r\n","import * as err from './errors'\r\nimport * as suc from './success'\r\n\r\nexport { err, suc }\r\n","export const ok = {\r\n  code: 's200',\r\n  description: 'everything is fine !'\r\n}\r\n","export const emailExists = {\r\n  code: 'e01',\r\n  description: 'email is already used because it was found in our database'\r\n}\r\n\r\nexport const usernameExists = {\r\n  code: 'e02',\r\n  description: 'username is already used because it was found in our database'\r\n}\r\nexport const tokenExists = {\r\n  code: 'e03',\r\n  description: 'token is already used because it was found in our database'\r\n}\r\nexport const unknownTypeToCheck= {\r\n  code: 'e04',\r\n  description: 'the type to check if it exist in our database is unknown'\r\n}\r\nexport const wrongToken = {\r\n  code: 'e05',\r\n  description: 'token is unauthorized !'\r\n}\r\nexport const tokenDoesNotExists = {\r\n  code: 'e06',\r\n  description: 'token does not exists !'\r\n}\r\nexport const tokenIsNotSpecified = {\r\n  code: 'e07',\r\n  description: 'token is not specified. Please specify a token'\r\n}\r\nexport const usernameIsNotSpecified = {\r\n  code: 'e08',\r\n  description: 'username is not specified. Please specify a username'\r\n}\r\nexport const emailIsNotSpecified = {\r\n  code: 'e09',\r\n  description: 'email is not specified. Please specify an email'\r\n}\r\nexport const nameIsNotSpecified = {\r\n  code: 'e10',\r\n  description: 'nameis not specified. Please specify a name'\r\n}\r\nexport const lastnameIsNotSpecified = {\r\n  code: 'e11',\r\n  description: 'lastname is not specified. Please specify a lastname'\r\n}\r\nexport const passwordIsNotSpecified = {\r\n  code: 'e12',\r\n  description: 'password is not specified. Please specify a password'\r\n}\r\n","import * as err from './errors'\r\nimport * as suc from './success'\r\n\r\nexport { err, suc }\r\n","export const userCreated = {\r\n    code: 's1',\r\n    description: 'user was created !'\r\n}\r\nexport const tokenAdded = {\r\n    code: 's2',\r\n    description: 'token was correctly added to the database !'\r\n}\r\n","import * as basicsCode from './Basics'\r\nimport * as userCode from './Users'\r\n\r\nexport { basicsCode, userCode }\r\n","\r\n\r\n//databse constantes\r\nexport const DB_HOSTNAME_DEV = \"localhost\"\r\nexport const DB_PORT_DEV = \"27017\"\r\nexport const DB_NAME_DEV = \"domotic\"\r\n\r\nexport const DB_HOSTNAME_PROD = \"localhost\"\r\nexport const DB_PORT_PROD = \"27017\"\r\nexport const DB_NAME_PROD = \"domotic\"\r\n\r\n\r\n//server constantes\r\nexport const SERVER_PORT_DEV = \"5973\" // port d'écoute du serveur en développement\r\nexport const SERVER_PORT_PROD = \"4957\" // port d'écoute du serveur en production\r\n\r\n//variables de développement\r\nexport const DEFAULT_TOKEN = \"8637104155366878\"\r\n","import mongoose from 'mongoose'\r\nconst Schema = mongoose.Schema\r\n\r\nconst initializeSchema = async() => {\r\n  const usersSchema = new Schema({\r\n    lastname: String,\r\n    name: String,\r\n    username:{type:String, unique:true},\r\n    email:{type:String, unique:true},\r\n    password: String,\r\n    token: {type: Schema.Types.ObjectId, ref: 'Token'},\r\n  }, {versionKey: false }, {collection: 'users'})\r\n  const tokenSchema = new Schema({\r\n    token: {type: String, unique: true},\r\n    isAdmin: Boolean,\r\n    isAllowed: Boolean\r\n  }, {versionKey: false }, {collection: 'users'})\r\n\r\n  const User = mongoose.model('User', usersSchema)\r\n  const Token = mongoose.model('Token', tokenSchema)\r\n}\r\n\r\nexport default initializeSchema\r\n","import gpio from 'gpio'\r\n\r\nexport const RELAIS = gpio.export(4, {\r\n  direction: gpio.DIRECTION.OUT,\r\n  interval: 500,\r\n  ready: () => {turnOn().then(setTimeout(turnOff(), 500))}\r\n}) // = on connecte le relais au GPIO 4, et on le configure en sortie\r\n\r\nconst turnOn = async () => {\r\n  await RELAIS.reset() // on le remet à zéro au cas où\r\n  await RELAIS.set() // puis on le passe à 1\r\n}\r\nconst turnOff = async () => {\r\n  await RELAIS.reset()  // on éteint le relais\r\n}\r\n","import * as init from './initialize'\r\n\r\n//On démarre les différents services\r\ninit.setEnvVar()\r\n.then(init.startDB)\r\n.then(init.startServ)\r\n","import * as ne from './NODE_ENV'\r\n\r\nconst setEnvVar = async () => {\r\n  await ne.definePort() // le port du serveur\r\n  await ne.defineDB()// on crée les variables environnement pour gérer le database\r\n}\r\n\r\nexport default setEnvVar\r\n","import log from 'my-own-logger' // logger\r\nimport * as cte from '../../constantes' // on importe les valeurs des constantes qui sont exclues des exports github\r\n\r\n\r\nconst {DB_HOSTNAME_DEV} = cte\r\nconst {DB_PORT_DEV} = cte\r\nconst {DB_NAME_DEV} = cte\r\n\r\nconst {DB_HOSTNAME_PROD} = cte\r\nconst {DB_PORT_PROD} = cte\r\nconst {DB_NAME_PROD} = cte\r\n\r\n\r\nconst defineDB = async () => {\r\n  const { NODE_ENV } = process.env\r\n  if (NODE_ENV === 'development'){\r\n    await (process.env.DB_HOSTNAME = DB_HOSTNAME_DEV)\r\n    await (process.env.DB_PORT = DB_PORT_DEV)\r\n    await (process.env.DB_NAME = DB_NAME_DEV)\r\n    log({\r\n      name: \"ENV VAR\",\r\n      status:'reg',\r\n      mode: `dev`,\r\n      value: `dataBase variables`\r\n    })\r\n  }\r\n  else if(NODE_ENV === 'production '){\r\n    await (process.env.DB_HOSTNAME = DB_HOSTNAME_PROD)\r\n    await (process.env.DB_PORT = DB_HOSTNAME_PROD)\r\n    await (process.env.DB_NAME = DB_HOSTNAME_PROD)\r\n    log({\r\n      name: \"ENV VAR\",\r\n      status:'reg',\r\n      mode: `prod`,\r\n      value: `dataBase variables`\r\n    })\r\n  }\r\n  else{\r\n    log({\r\n      name: \"ENV VAR\",\r\n      status:'err',\r\n      value:`no env var for database have been defined cause NODE_ENV is not in development or in production`\r\n    })\r\n  }\r\n}\r\n\r\nexport default defineDB\r\n","import definePort from './server' //pour définir le port du server\r\nimport defineDB from './database' // pour définir les consatntes de connexion à la base de données\r\n\r\nexport { definePort, defineDB }\r\n","import log from 'my-own-logger' // logger\r\nimport * as cte from '../../constantes' // on importe les valeurs des constantes qui sont exclues des exports github\r\n\r\nconst {SERVER_PORT_DEV} = cte\r\nconst {SERVER_PORT_PROD} = cte\r\n\r\n\r\nconst definePort = async () => {\r\n  const { NODE_ENV } = process.env\r\n  if (NODE_ENV === 'development'){\r\n    await (process.env.SERVER_PORT = SERVER_PORT_DEV)\r\n    log({name: \"ENV VAR\",status:'reg', mode: `dev`, value: `server variables`})\r\n  }\r\n  else if(NODE_ENV === 'production '){\r\n    await (process.env.SERVER_PORT = SERVER_PORT_PROD)\r\n    log({name: \"ENV VAR\",status:'reg', mode: `prod`, value: `server variables`})\r\n  }\r\n  else{\r\n    log({name: \"ENV VAR\",status:'err', value:`no env var for server have been defined cause NODE_ENV is not in development or in production`})\r\n  }\r\n}\r\n\r\nexport default definePort\r\n","import log from 'my-own-logger' // logger\r\nimport express from 'express' //pour le routage\r\nimport bodyParser from 'body-parser' //pour parser un json\r\n\r\nimport * as rt from '../routes' // import des routes\r\n\r\nconst startServ = async () => {\r\n  const { SERVER_PORT } = process.env\r\n\r\n  //instantiation du serveur\r\n  const app = express()\r\n\r\n\r\n  //paramétrage du serveur\r\n  app.use(bodyParser.json()) //permet de recevoir un beau Json en body d'une requête\r\n  app.use(bodyParser.urlencoded({ extended: true }))\r\n\r\n  //connection des routes au SERVER_PORT\r\n  app.use('/gate', rt.GateRoute)\r\n  app.use('/users', rt.UsersRoute)\r\n\r\n\r\n  //lancement des routes /!\\ doit être lancé après la connexion à la base de donnée, sinon les schémas ne seront pas définis\r\n  await (rt.initializeRoutes(\r\n    (er) => {\r\n      if (er){\r\n        log({\r\n          name: 'Routes',\r\n          status: 'err',\r\n          value:err\r\n        })\r\n      }\r\n      else{\r\n        log({\r\n          name: 'Routes',\r\n          status: 'reg',\r\n          value:'are all initialized !'\r\n        })\r\n      }\r\n    }\r\n  ))\r\n\r\n  //lancement du serveur\r\n  await (app.listen(SERVER_PORT, () => {log({name: \"Express\",status:'reg', value: `is conected on port ${SERVER_PORT}`})}))\r\n\r\n}\r\n\r\nexport default startServ\r\n","import setEnvVar from './EnvVar'\r\nimport startDB from './mongo'\r\nimport startServ from './express'\r\n\r\nexport {setEnvVar, startDB, startServ}\r\n","import log from 'my-own-logger' // logger\r\nimport mongoose from 'mongoose'\r\nimport initializeSchema from '../database/schemas'\r\n\r\nconst startDB = async () => {\r\n  //on importe les variables environnement préalablement définies\r\n  const {DB_HOSTNAME, DB_PORT, DB_NAME} = process.env\r\n\r\n  // on en déduit l'url de connexion de la bdd mongodb\r\n  const url = `mongodb://${DB_HOSTNAME}:${DB_PORT}/${DB_NAME}`\r\n\r\n  //on paramètre les options de la connexion à la base\r\n  const options ={\r\n    promiseLibrary: Promise,\r\n    useNewUrlParser: true,\r\n    useFindAndModify: false,\r\n    useCreateIndex: true,\r\n    connectTimeoutMS: 1000\r\n  }\r\n\r\n  //fonction permettant d'afficher les erreurs s'il y en a lors de la connexion à la base\r\n  const _mongooseConnectLogResult = (error) => {\r\n    if (error)\r\n      log({name: \"MongoDB\",status:'err', value: `${error}`})\r\n  }\r\n\r\n  //On paramètre les événement de mongoose\r\n  mongoose.connection.on(\"connecting\", () => {\r\n    log({name: \"MongoDB\",status:'wait', value: `is starting up...`})\r\n  })\r\n  mongoose.connection.on(\"connected\", () => {\r\n    log({name: \"MongoDB\",status:'reg', value: `is connected on port ${DB_PORT} !`})\r\n  })\r\n  mongoose.connection.on(\"disconnecting\", () => {\r\n    log({name: \"MongoDB\",status:'wait', value: `is diconnecting...`})\r\n  })\r\n  mongoose.connection.on(\"disconnected\", () => {\r\n    log({name: \"MongoDB\",status:'warn', value: `is disconnected !`})\r\n  })\r\n  mongoose.connection.on(\"error\", () => {\r\n    log({name: \"MongoDB\",status:'err', value: `error !`})\r\n  })\r\n\r\n  //on définit les schémas de la bdd\r\n  await initializeSchema()\r\n\r\n  //on lance et on attend la connexion à la base\r\n  await (mongoose.connect(url, options, _mongooseConnectLogResult))\r\n\r\n}\r\n\r\nexport default startDB\r\n","import express from 'express'\r\n\r\n//import des middlewares\r\nimport * as mdl from './middlewares'\r\n\r\n//instanciation de la route\r\nexport const GateRoute = express.Router()\r\n\r\nexport const initializeRoute = async () => {\r\n  GateRoute.put('/toogle', mdl.toogle)\r\n}\r\n","export { GateRoute, initializeRoute } from './gate'\r\n","import toogle from './toogle.js'\r\n\r\nexport { toogle }\r\n","import mongoose from 'mongoose'\r\nimport { RELAIS } from '../../../helpers/GPIO'\r\n\r\n//regarder dans la BDD si le token de l'utilisateur est bon\r\n\r\nconst toggle = async() => {\r\n  await RELAIS()\r\n}\r\nexport default toggle\r\n// middleware to execute when we are in gate/toogle on a PUT\r\n","//on importe toutes les routes\r\nimport * as gate from './gate'\r\nimport * as users from './users'\r\n\r\nconst UsersRoute = users.UsersRoute\r\nconst GateRoute = gate.GateRoute\r\n\r\nconst initializeRoutes = async (callback) => {\r\n  let errors\r\n  try{\r\n    await (gate.initializeRoute())\r\n  }\r\n  catch (error){\r\n    errors += error\r\n  }\r\n  try{\r\n    await (users.initializeRoute())\r\n  }\r\n  catch (error){\r\n    errors += error\r\n  }\r\n\r\n  !errors ? callback(errors) : callback()\r\n}\r\n\r\nexport {initializeRoutes, GateRoute, UsersRoute }\r\n","import log from 'my-own-logger'\r\nimport mongoose from 'mongoose'\r\nimport { userCode, basicsCode } from '../../../codes'\r\n\r\n//authentification in users/amdin\r\n\r\nconst authentificate = (req, res, next) =>{\r\n  const Token = mongoose.model('Token')\r\n  const { token } = req.headers\r\n  if (token === undefined){\r\n    const er = userCode.err.tokenIsNotSpecified\r\n    return res.status(404).send(`${er.code} - ${er.description}`)\r\n  }\r\n  const query = Token.find({ token }, (er, data) => {\r\n    if (er){\r\n      log({\r\n        name: 'API',\r\n        status: 'err',\r\n        value: `error : ${ er }`\r\n      })\r\n      const iEr = basicsCode.err.internalError\r\n      return res.status(500).send(`${iEr.code} - ${iEr.description}`)\r\n    }\r\n    if (data.length){\r\n      if(data.filter((token) => (token.isAdmin === true)).length){\r\n        res.status(200)\r\n        return next()\r\n      } else {\r\n        log({\r\n          name: 'API',\r\n          status: 'warn',\r\n          value: `somebody is trying to connect as admin with a wrong token`\r\n        })\r\n        const iWer = userCode.err.wrongToken\r\n        return res.status(401).send(`${iWer.code} - ${iWer.description}`)\r\n      }\r\n    } else {\r\n    const iTer = userCode.err.tokenDoesNotExists\r\n    return res.status(401).send(`${iTer.code} - ${iTer.description}`)\r\n    }\r\n  })\r\n}\r\n\r\nexport default authentificate\r\n","import mongoose from 'mongoose'\r\nimport log from 'my-own-logger'\r\nimport { basicsCode } from '../../../codes'\r\n\r\nconst getUsers = async(req, res, next) => {\r\n  const { usernames } = req.body\r\n  const FullUser = mongoose.model('User')\r\n  let names = ''\r\n  if (usernames === undefined || !usernames.length ){\r\n    //return all users\r\n    names=new RegExp('/*')\r\n  }\r\n  else {\r\n    //return all users asked\r\n    usernames.forEach(username => names+='|'+username)\r\n    names = new RegExp(names.slice(1))\r\n  }\r\n  // User.find({username:names}, 'lastname name username email').populate().exec((err, data) => {\r\n  FullUser.find({username:names}, 'lastname name username email').populate('token').exec((err, data) => {\r\n    if (err){\r\n      log({name:'Mongoose', status: 'err', value: er})\r\n      const erC = basicsCode.err.internalError\r\n      return res.status(200).send(`${erC.code} - ${erC.description} `)\r\n    }\r\n    try{\r\n      const results = data.map(user => {\r\n        const {lastname, name, username, email, token} = user\r\n        const { isAdmin, isAllowed } = token\r\n        return {lastname, name, username, email, isAdmin, isAllowed}\r\n      })\r\n      return res.status(200).send(results)\r\n    }\r\n    catch(er){\r\n      log({name:'Mongoose', status: 'err', value: er})\r\n      const erB = basicsCode.err.internalError\r\n      return res.status(500).send(`${erB.code} - ${erB.description}`)\r\n    }\r\n  })\r\n}\r\n\r\nexport default getUsers\r\n","import auth from './authentification'\r\nimport * as newToken from './newToken'\r\nimport getUsers from './getUsers'\r\n\r\nexport { auth, newToken, getUsers }\r\n","import log from 'my-own-logger'\r\nimport mongoose from 'mongoose'\r\nimport { userCode, basicsCode } from '../../../codes'\r\n\r\nimport { checkIfDataExists } from '../helpers'\r\n\r\n\r\nexport const isTokenOk = async(req, res, next) => await checkIfDataExists('token', req, res, next)\r\nexport const addToken = async(req, res, next) =>{\r\n  const { token } = req.body\r\n  if (token === undefined){\r\n    const er = userCode.err.tokenIsNotSpecified\r\n    return res.status(404).send(`${er.code} - ${er.description}`)\r\n  }\r\n  let { isAdmin, isAllowed } = req.body\r\n  if (isAdmin === undefined)\r\n    isAdmin=false\r\n  if (isAllowed === undefined)\r\n    isAllowed=true\r\n  const newToken = new mongoose.model('Token')({ token, isAdmin, isAllowed })\r\n\r\n  newToken.save((err, account) => {\r\n    if (err){\r\n      log({\r\n        name: 'Mongoose',\r\n        status: 'err',\r\n        value: `Error on adding token : ${ err }`\r\n      })\r\n      const iErr = basicsCode.err.internalError\r\n      return res.status(500).send(`${iErr.code} - ${iErr.description}`)\r\n    }\r\n    log({\r\n      name: 'Mongoose',\r\n      status: 'ok',\r\n      value: `token was added to the db !`\r\n    })\r\n    const uSuc = userCode.suc.tokenAdded\r\n    res.status(200).send(`${uSuc.code} - ${uSuc.description}`)\r\n    return next()\r\n  })\r\n}\r\n","import mongoose from 'mongoose'\r\nimport { userCode, basicsCode } from '../../../codes'\r\n\r\nconst checkIfDataExists = async(type, req, res, next) => {\r\n  const User = mongoose.model('User')\r\n  let result, error\r\n  switch(type){\r\n    case 'email':\r\n      const { email } = req.body\r\n      if (email === undefined){\r\n        const er = userCode.err.emailIsNotSpecified\r\n        return res.status(404).send(`${er.code} - ${er.description}`)\r\n      }\r\n      result = await User.find({ email })\r\n      error = {...userCode.err.emailExists, data:email}\r\n      break\r\n    case 'username':\r\n      const { username } = req.body\r\n      if (username === undefined){\r\n        const er = userCode.err.usernameIsNotSpecified\r\n        return res.status(404).send(`${er.code} - ${er.description}`)\r\n      }\r\n      result = await User.find({ username })\r\n      error = {...userCode.err.usernameExists, data:username}\r\n      break\r\n    case 'token':\r\n      const Token = mongoose.model('Token')\r\n      const { token } = req.body\r\n      if (token === undefined){\r\n        const er = userCode.err.tokenIsNotSpecified\r\n        return res.status(404).send(`${er.code} - ${er.description}`)\r\n      }\r\n      result = await Token.find({ token })\r\n      error = {...userCode.err.tokenExists, data:''}\r\n      break\r\n    case 'tokenBool':\r\n      result = await User.find({ token: req })\r\n      return result.length ? true : false\r\n      break\r\n    default:\r\n      log({name: 'API', status:'err', value:userCode.err.unknownTypeToCheck.description})\r\n      res.status(500).send(basicsCode.err.internalError.description)\r\n  }\r\n  try{\r\n    if(!result.length){\r\n      return next ()\r\n    }else{\r\n      res.status(409).send(`${error.code} - (${error.data}) ${error.description}`)\r\n    }\r\n  }\r\n  catch(er){\r\n    log({name: 'API', status:'err', value:er})\r\n    res.status(500).send(basicsCode.err.internalError.description)\r\n  }\r\n}\r\n\r\nexport default checkIfDataExists\r\n","import checkIfDataExists from './checkIfDataExists'\r\n\r\nexport { checkIfDataExists }\r\n","export { UsersRoute, initializeRoute } from './users'\r\n","import mongoose from 'mongoose'\r\n\r\n// mdl appelé en delete sur /users/admin\r\n\r\nconst deleteUser = () => {}\r\n\r\nexport default deleteUser\r\n","import deleteUser from './deleteUser'\r\nimport modifyUser from './modifyUser'\r\nimport * as newUser from './newUser'\r\n\r\nexport { newUser, modifyUser, deleteUser }\r\n","import mongoose from 'mongoose'\r\n\r\n// mdl appelé en put sur /users/admin\r\n\r\nconst modifyUser = () => {}\r\n\r\nexport default modifyUser\r\n","import log from 'my-own-logger'\r\nimport mongoose from 'mongoose'\r\nimport crypto from 'crypto'\r\nimport { userCode, basicsCode } from '../../../codes'\r\n\r\nimport { checkIfDataExists } from '../helpers'\r\n\r\n// mdl appelé en post sur /users/admin\r\n\r\nexport const isMailOk = async(req, res, next) => await checkIfDataExists('email', req, res, next)\r\nexport const isUsernameOk = async(req, res, next) => await checkIfDataExists('username', req, res, next)\r\nexport const register = async(req, res, next) =>{\r\n  const {lastname, name, username, email, password } = req.body\r\n  if (lastname === undefined){\r\n    const er = userCode.err.lastnameIsNotSpecified\r\n    return res.status(404).send(`${er.code} - ${er.description}`)\r\n  }\r\n  if (name === undefined){\r\n    const er = userCode.err.nameIsNotSpecified\r\n    return res.status(404).send(`${er.code} - ${er.description}`)\r\n  }\r\n  if (username === undefined){\r\n    const er = userCode.err.usernameIsNotSpecified\r\n    return res.status(404).send(`${er.code} - ${er.description}`)\r\n  }\r\n  if (email === undefined){\r\n    const er = userCode.err.emailIsNotSpecified\r\n    return res.status(404).send(`${er.code} - ${er.description}`)\r\n  }\r\n  if (password === undefined){\r\n    const er = userCode.err.passwordIsNotSpecified\r\n    return res.status(404).send(`${er.code} - ${er.description}`)\r\n  }\r\n  let token = crypto.randomBytes(32).toString('hex')\r\n  let i = 0\r\n  while ((await checkIfDataExists('tokenBool', token)) && (i<100)){\r\n    token = crypto.randomBytes(32).toString('hex')\r\n    i++\r\n  }\r\n  const safePwd = crypto.createHash('sha256').update(password).digest('hex')\r\n  const user = new mongoose.model('User')({\r\n    lastname, name, username, email, token,\r\n    password: safePwd\r\n  })\r\n  user.save((err, account) => {\r\n    if (err){\r\n      log({\r\n        name: 'Mongoose',\r\n        status: 'err',\r\n        value: `Error on creating ${ username } : ${ err }`\r\n      })\r\n      const iErr = basicsCode.err.internalError\r\n      return res.status(500).send(`${iErr.code} - ${iErr.description}`)\r\n    }\r\n    log({\r\n      name: 'Mongoose',\r\n      status: 'ok',\r\n      value: `${ username } was created !`\r\n    })\r\n    const uSuc = userCode.suc.userCreated\r\n    res.status(200).send(`${uSuc.code} - (${username}) ${uSuc.description}`)\r\n    return next()\r\n  })\r\n}\r\n","import express from 'express'\r\n\r\n//import des middlewares\r\nimport * as mdl from './middlewares'\r\nimport * as admin from './admin'\r\n\r\n//instanciation de la route\r\nexport const UsersRoute = express.Router()\r\n\r\nexport const initializeRoute = async () => {\r\n  UsersRoute.post('/',\r\n    mdl.newUser.isMailOk,\r\n    mdl.newUser.isUsernameOk,\r\n    mdl.newUser.register\r\n  )\r\n  UsersRoute.delete('/', mdl.deleteUser)\r\n  UsersRoute.put('/', mdl.modifyUser)\r\n\r\n\r\n  UsersRoute.use('/admin', admin.auth)\r\n  UsersRoute.post('/admin',\r\n    admin.newToken.isTokenOk,\r\n    admin.newToken.addToken,\r\n  )\r\n  UsersRoute.get('/admin',\r\n    admin.getUsers,\r\n  )\r\n}\r\n","module.exports = require(\"body-parser\");","module.exports = require(\"crypto\");","module.exports = require(\"express\");","module.exports = require(\"gpio\");","module.exports = require(\"mongoose\");","module.exports = require(\"my-own-logger\");"],"sourceRoot":""}